# Multi-Module Projects

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

Spigradle supports Gradle multi-module projects, allowing you to organize your plugin code into multiple modules with shared dependencies and platform-specific implementations.

## Table of contents

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

- [Why Multi-Module?](#why-multi-module)
- [Requirements](#requirements)
- [Project Structure](#project-structure)
- [Setup Guide](#setup-guide)
  - [Step 1: Configure settings.gradle](#step-1-configure-settingsgradle)
  - [Step 2: Configure root build.gradle](#step-2-configure-root-buildgradle)
  - [Step 3: Configure subproject build.gradle](#step-3-configure-subproject-buildgradle)
- [Common Patterns](#common-patterns)
  - [Common/Shared Module](#commonshared-module)
  - [Platform-Specific Modules](#platform-specific-modules)
  - [API Module](#api-module)
- [Complete Examples](#complete-examples)
- [Dependency Management](#dependency-management)
- [Building Multi-Module Projects](#building-multi-module-projects)
- [Best Practices](#best-practices)
- [Troubleshooting](#troubleshooting)
- [See also](#see-also)

## Why Multi-Module?

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

Multi-module projects offer several benefits for Minecraft plugin development:

- **Code Reuse**: Share common code across multiple platform implementations (Spigot, BungeeCord, NukkitX)
- **Separation of Concerns**: Isolate platform-specific code from business logic
- **API/Implementation Split**: Expose a public API while keeping implementation details private
- **Better Organization**: Manage large codebases with clear module boundaries
- **Independent Versioning**: Version modules independently if needed
- **Cleaner Dependencies**: Each module declares only the dependencies it needs

**Common use cases:**
- Cross-platform plugins (Spigot + BungeeCord + Velocity)
- Plugin suite with shared utilities
- Plugin with public API for developers
- Large plugins split into feature modules

## Requirements

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

- Gradle 8.0+ (the latest version is recommended)
- Spigradle 4.0.0 or higher
- Basic understanding of Gradle multi-module projects

To update your gradle wrapper:

```bash
gradlew wrapper --gradle-version 9.2.1 --distribution-type all
```

## Project Structure

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

A typical multi-module Spigradle project structure:

```
my-plugin/
├── settings.gradle                # Declares all modules
├── build.gradle                   # Root build configuration
├── gradle.properties              # Shared properties (including version)
├── gradle/
├── └── libs.versions.toml         # your unique dependencies
├── common/                        # Shared code module
│   ├── build.gradle
│   └── src/main/java/...
├── spigot/                        # Spigot implementation
│   ├── build.gradle
│   └── src/main/java/...
├── bungee/                        # BungeeCord implementation
│   ├── build.gradle
│   └── src/main/java/...
└── api/                           # Public API (optional)
    ├── build.gradle
    └── src/main/java/...
```

## Setup Guide

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

### Step 1: Configure settings.gradle

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

Define all modules in your project.

> Gradle supports importing multiple version catalogs from `settings.gradle(.kts)` via `dependencyResolutionManagement { versionCatalogs { ... } }`. See Gradle’s “Version Catalogs” docs for details. citeturn0search0

**Groovy DSL:**
```groovy
dependencyResolutionManagement {
    repositories {
        mavenCentral()
    }
    versionCatalogs {
        // Centralized versions from gradle.properties
        // For Spigot modules
        create('spigots') {
            from("io.typst:spigot-catalog:${property("catalog.spigot.version")}")
        }
        // For BungeeCord modules
        create('bungees') {
            from("io.typst:bungee-catalog:${property("catalog.bungee.version")}")
        }
        // For common plugins/dependencies (idea-ext, lombok, etc.)
        // NOTE: commons catalog = idea-ext, lombok (bStats is NOT here)
        create('commons') {
            from("io.typst:common-catalog:${property("catalog.common.version")}")
        }
    }
}

rootProject.name = 'my-plugin'

include('common', 'spigot', 'bungee', 'api') // api is optional

// OPTIONAL: rename child projects.
// Purpose: archiveBaseName / Maven artifactId derived from project.name
// rootProject.children.each { p ->
//     p.name = "my-plugin-${p.name}"
// }
```

**Kotlin DSL (`settings.gradle.kts`):**
```kotlin
dependencyResolutionManagement {
    repositories {
        mavenCentral()
    }
    versionCatalogs {
        // Centralized versions from gradle.properties
        // For Spigot modules
        create("spigots") {
            from("io.typst:spigot-catalog:${property("catalog.spigot.version")}")
        }
        // For BungeeCord modules
        create("bungees") {
            from("io.typst:bungee-catalog:${property("catalog.bungee.version")}")
        }
        // For common plugins/dependencies (idea-ext, lombok, etc.)
        // NOTE: commons catalog = idea-ext, lombok (bStats is NOT here)
        create("commons") {
            from("io.typst:common-catalog:${property("catalog.common.version")}")
        }
    }
}

rootProject.name = "my-plugin"

include("common", "spigot", "bungee", "api") // api is optional

// OPTIONAL: rename child projects.
// Purpose: archiveBaseName / Maven artifactId derived from project.name
// rootProject.children.forEach { p ->
//     p.name = "my-plugin-${p.name}"
// }
```

> **Important:** `ideaExt` is only in the `commons` catalog (not in platform catalogs).

### Step 2: Configure root build.gradle

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

Configure shared settings for all subprojects.

> **Important:** Version is managed centrally in `gradle.properties`. Do **not** set `version = "1.0.0"` (or similar) in build scripts.

<details>
<summary>Groovy DSL</summary>

```groovy
plugins {
    id 'base'
}

// You can configure shared settings here (for example, repositories and dependencies),
// but I recommend configuring them explicitly in each submodule.
allprojects {
    group = 'com.example.myplugin'
    // version is managed by gradle.properties (do not set it here)
}
```

</details>

<details>
<summary>Kotlin DSL (build.gradle.kts)</summary>

```kotlin
plugins {
    id("base")
}

// You can configure shared settings here (for example, repositories and dependencies),
// but I recommend configuring them explicitly in each submodule.
allprojects {
    group = "com.example.myplugin"
    // version is managed by gradle.properties (do not set it here)
}
```

</details>

**Example `gradle.properties` (root):**
```properties
# Project version (centralized)

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)
version=1.0.0

# External catalogs (centralized)

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)
catalog.spigot.version=1.0.0
catalog.bungee.version=1.0.0
catalog.common.version=1.0.0
```

**Example `gradle/libs.version.toml` (root):**
```toml
[versions]
gson = "2.10.1"

[libraries]
gson = {group = "com.google.code.gson", name = "gson", version.ref = "gson"}
```

### Step 3: Configure subproject build.gradle

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

#### Common module (common/build.gradle)

The common module has no platform-specific dependencies.

<details>
<summary>Groovy DSL</summary>

```groovy
plugins {
    id 'java'
    // or: id 'org.jetbrains.kotlin.jvm' version '2.2.21'
}

repositories {
    mavenCentral()
}

// No Spigradle plugin needed for common module
dependencies {
    // Add common dependencies here
    compileOnly 'org.jetbrains:annotations:24.0.1'
}

java {
    toolchain {
        languageVersion.set(JavaLanguageVersion.of(21))
    }
}
```

</details>

<details>
<summary>Kotlin DSL (common/build.gradle.kts)</summary>

```kotlin
plugins {
    id("java")
    // or: id("org.jetbrains.kotlin.jvm") version "2.2.21"
}

repositories {
    mavenCentral()
}

// No Spigradle plugin needed for common module
dependencies {
    // Add common dependencies here
    compileOnly("org.jetbrains:annotations:24.0.1")
}

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(21)
    }
}
```

</details>

> Gradle’s Java toolchain configuration is done via the `java { toolchain { languageVersion = JavaLanguageVersion.of(...) } }` block. citeturn0search1

#### Spigot module (spigot/build.gradle)

> **Important:** Platform plugins do **not** apply `java` automatically. Add `java` or `org.jetbrains.kotlin.jvm` (version `2.2.21`) explicitly.

<details>
<summary>Groovy DSL</summary>

```groovy
plugins {
    id 'java'

    // Spigradle plugin (via version catalog)
    alias(spigots.plugins.spigot)

    // Optional (commons catalog only)
    // alias(commons.plugins.ideaExt)
    // alias(commons.plugins.lombok)
}

repositories {
    mavenCentral()

    // Repository shortcuts
    spigotRepos {
        papermc()
    }
}

dependencies {
    // Depend on common module
    implementation project(':common')

    // Paper API (from catalog)
    compileOnly spigots.paper
}

spigot {
    apiVersion = '1.21'
    depend = ['Vault']

    commands {
        register('mycommand') {
            description = 'My command'
        }
    }
}

java {
    toolchain {
        languageVersion.set(JavaLanguageVersion.of(21))
    }
}

// include the common in jar
tasks.jar {
    dependsOn(':common:jar')
    from project(':common').sourceSets.main.output
}
```

</details>

<details>
<summary>Kotlin DSL (spigot/build.gradle.kts)</summary>

```kotlin
plugins {
    id("java")

    // Spigradle plugin (via version catalog)
    alias(spigots.plugins.spigot)

    // Optional (commons catalog only)
    // alias(commons.plugins.ideaExt)
    // alias(commons.plugins.lombok)
}

repositories {
    mavenCentral()

    // Repository shortcuts
    spigotRepos {
        papermc()
    }
}

dependencies {
    // Depend on common module
    implementation(project(":common"))

    // Paper API (from catalog)
    compileOnly(spigots.paper.api)
}

spigot {
    apiVersion = "1.21"
    depends = listOf("Vault")

    commands {
        register("mycommand") {
            description = "My command"
        }
    }
}

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(21)
    }
}

// include the common in jar
tasks.jar {
    dependsOn(":common:jar")
    from(project(":common").sourceSets.main.get().output)
}
```

</details>

#### BungeeCord module (bungee/build.gradle)

> **Important:** Platform plugins do **not** apply `java` automatically. Add `java` or `org.jetbrains.kotlin.jvm` (version `2.2.21`) explicitly.

<details>
<summary>Groovy DSL</summary>

```groovy
plugins {
    id 'java'

    // Spigradle plugin (via version catalog)
    alias(bungees.plugins.bungee)

    // Optional (commons catalog only)
    // alias(commons.plugins.lombok)
}

repositories {
    mavenCentral()

    // Repository shortcuts
    bungeeRepos {
        sonatype()
        minecraftLibraries()
    }
}

dependencies {
    // Depend on common module
    implementation project(':common')

    // BungeeCord API (from catalog)
    compileOnly bungees.bungeecord
}

bungee {
    author = 'YourName'
    depends = ['SomePlugin']
}

// Shadow common module into final JAR
tasks.jar {
    dependsOn(':common:jar')
    from project(':common').sourceSets.main.output
}

java {
    toolchain {
        languageVersion.set(JavaLanguageVersion.of(21))
    }
}
```

</details>

<details>
<summary>Kotlin DSL (bungee/build.gradle.kts)</summary>

```kotlin
plugins {
    id("java")

    // Spigradle plugin (via version catalog)
    alias(bungees.plugins.bungee)

    // Optional (commons catalog only)
    // alias(commons.plugins.lombok)
}

repositories {
    mavenCentral()

    // Repository shortcuts
    bungeeRepos {
        sonatype()
        minecraftLibraries()
    }
}

dependencies {
    // Depend on common module
    implementation(project(":common"))

    // BungeeCord API (from catalog)
    compileOnly(bungees.bungeecord)
}

bungee {
    author = "YourName"
    depends = listOf("SomePlugin")
}

// Shadow common module into final JAR
tasks.jar {
    dependsOn(":common:jar")
    from(project(":common").sourceSets.main.get().output)
}

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(21)
    }
}
```

</details>

## Common Patterns

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

### Common/Shared Module

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

The common module typically contains:
- Business logic independent of platform
- Data models and DTOs
- Utility classes
- Configuration handling
- Database access layer
- API interfaces

**Key characteristics:**
- No Spigradle plugin applied
- No platform-specific dependencies (Spigot, BungeeCord APIs)
- Can use libraries like Gson, databases, etc.

**Example structure:**
```
common/
└── src/main/java/com/example/myplugin/
    ├── config/
    │   └── PluginConfig.java
    ├── model/
    │   └── PlayerData.java
    ├── service/
    │   └── DataService.java
    └── util/
        └── MessageFormatter.java
```

### Platform-Specific Modules

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

Each platform module contains:
- Platform-specific entry point (extends JavaPlugin/Plugin/PluginBase)
- Platform API integrations
- Event listeners
- Command implementations
- Platform-specific utilities

**Example Spigot module:**
```
spigot/
└── src/main/java/com/example/myplugin/spigot/
    ├── MySpigotPlugin.java      # extends JavaPlugin
    ├── listeners/
    │   └── PlayerJoinListener.java
    └── commands/
        └── MyCommand.java
```

**Example BungeeCord module:**
```
bungee/
└── src/main/java/com/example/myplugin/bungee/
    ├── MyBungeePlugin.java      # extends Plugin
    └── listeners/
        └── ServerConnectListener.java
```

### API Module

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

For plugins that expose a public API for other developers:

**Groovy DSL (api/build.gradle):**
```groovy
plugins {
    id 'java'
    // Optionally apply platform plugin via catalog if your API needs it.
    // alias(spigots.plugins.spigot)
}

repositories {
    mavenCentral()
    spigotRepos { papermc() }
}

dependencies {
    // API typically doesn't depend on implementation
    compileOnly spigots.paper  // Only if needed
}

// tasks.detectSpigotMain.enabled = false

java {
    toolchain {
        languageVersion.set(JavaLanguageVersion.of(21))
    }
}
```

**Kotlin DSL (api/build.gradle.kts):**
```kotlin
plugins {
    id("java")
    // Optionally apply platform plugin via catalog if your API needs it.
    // alias(spigots.plugins.base)
}

repositories {
    mavenCentral()
    spigotRepos { papermc() }
}

dependencies {
    // API typically doesn't depend on implementation
    compileOnly(spigots.paper.api)  // Only if needed
}

// tasks.detectSpigotMain.enabled = false

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(21)
    }
}
```

**Other modules depend on the API:**

Groovy DSL:
```groovy
// spigot/build.gradle
dependencies {
    api project(':api')           // Expose API to consumers
    implementation project(':common')  // Hide implementation
}
```

Kotlin DSL:
```kotlin
// spigot/build.gradle.kts
dependencies {
    api(project(":api"))           // Expose API to consumers
    implementation(project(":common"))  // Hide implementation
}
```

## Complete Examples

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

### Cross-Platform Plugin Example

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

A complete example of a plugin that works on both Spigot and BungeeCord:

**Project structure:**
```
my-plugin/
├── settings.gradle
├── build.gradle
├── common/
│   ├── build.gradle
│   └── src/main/java/com/example/
│       ├── MyPluginConfig.java
│       └── MessageService.java
├── spigot/
│   ├── build.gradle
│   └── src/main/java/com/example/spigot/
│       ├── MySpigotPlugin.java
│       └── listeners/PlayerListener.java
└── bungee/
    ├── build.gradle
    └── src/main/java/com/example/bungee/
        ├── MyBungeePlugin.java
        └── listeners/ProxyListener.java
```

**Common module code:**
```java
// common/src/main/java/com/example/MessageService.java
package com.example;

public class MessageService {
    public String formatMessage(String player, String message) {
        return "[MyPlugin] " + player + ": " + message;
    }
}
```

**Spigot module code:**
```java
// spigot/src/main/java/com/example/spigot/MySpigotPlugin.java
package com.example.spigot;

import com.example.MessageService;
import org.bukkit.plugin.java.JavaPlugin;

public class MySpigotPlugin extends JavaPlugin {
    private MessageService messageService;

    @Override
    public void onEnable() {
        messageService = new MessageService();
        getLogger().info("Spigot plugin enabled!");
    }
}
```

**BungeeCord module code:**
```java
// bungee/src/main/java/com/example/bungee/MyBungeePlugin.java
package com.example.bungee;

import com.example.MessageService;
import net.md_5.bungee.api.plugin.Plugin;

public class MyBungeePlugin extends Plugin {
    private MessageService messageService;

    @Override
    public void onEnable() {
        messageService = new MessageService();
        getLogger().info("BungeeCord plugin enabled!");
    }
}
```

### Using build-logic for Shared Configuration

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

For complex multi-module projects, use `build-logic` composite build with convention plugins to share build logic. This is the modern approach recommended by Gradle over `buildSrc`.

**Project structure:**
```
my-plugin/
├── build-logic/
│   ├── settings.gradle.kts
│   ├── build.gradle.kts
│   └── src/main/kotlin/
│       ├── common-conventions.gradle.kts
│       ├── spigot-conventions.gradle.kts
│       └── bungee-conventions.gradle.kts
├── settings.gradle.kts
├── build.gradle.kts
└── ...modules...
```

**Step 1: Configure build-logic/settings.gradle.kts:**
```kotlin
rootProject.name = "build-logic"

versionCatalogs {
    // Centralized versions from gradle.properties
    // For Spigot modules
    create('spigots') {
        from("io.typst:spigot-catalog:${property("catalog.spigot.version")}")
    }
    // For BungeeCord modules
    create('bungees') {
        from("io.typst:bungee-catalog:${property("catalog.bungee.version")}")
    }
    // For common plugins/dependencies (idea-ext, lombok, etc.)
    // NOTE: commons catalog = idea-ext, lombok (bStats is NOT here)
    create('commons') {
        from("io.typst:common-catalog:${property("catalog.common.version")}")
    }
}
```

**Step 2: Configure build-logic/build.gradle.kts:**
```kotlin
plugins {
    `kotlin-dsl`
}

repositories {
    mavenCentral()
    gradlePluginPortal()
}

dependencies {
    // Add Spigradle plugin(s) to convention plugin classpath if needed
    implementation(spigots.spigradleSpigot)
    implementation(spigots.spigradleBungee)
}
```

**Step 3: Create convention plugins:**

**build-logic/src/main/kotlin/common-conventions.gradle.kts:**
```kotlin
plugins {
    id("java")
}

repositories {
    mavenCentral()
}

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(21)
    }
}
```

**build-logic/src/main/kotlin/spigot-conventions.gradle.kts:**
```kotlin
plugins {
    id("common-conventions")
    alias(spigots.plugins.spigot)
}

repositories {
    spigotRepos { papermc() }
}

dependencies {
    compileOnly(spigots.paper.api)
}

spigot {
    apiVersion = "1.21"
}
```

**build-logic/src/main/kotlin/bungee-conventions.gradle.kts:**
```kotlin
plugins {
    id("common-conventions")
    alias(bungees.plugins.bungee)
}

repositories {
    bungeeRepos {
        sonatype()
        minecraftLibraries()
    }
}

dependencies {
    compileOnly(bungees.bungeecord)
}
```

**Step 4: Include build-logic in main settings.gradle.kts:**
```kotlin
pluginManagement {
    includeBuild("build-logic")
}

rootProject.name = "my-plugin"

include("common", "spigot", "bungee", "api")
```

**Step 5: Apply conventions in module build files:**

**common/build.gradle.kts:**
```kotlin
plugins {
    id("common-conventions")
}

dependencies {
    compileOnly("org.jetbrains:annotations:24.0.1")
}
```

**spigot/build.gradle.kts:**
```kotlin
plugins {
    id("spigot-conventions")
}

dependencies {
    implementation(project(":common"))
}

spigot {
    depends = listOf("Vault")

    commands {
        register("mycommand") {
            description = "My command"
        }
    }
}

tasks.jar {
    dependsOn(":common:jar")
    from(project(":common").sourceSets.main.get().output)
}
```

**bungee/build.gradle.kts:**
```kotlin
plugins {
    id("bungee-conventions")
}

dependencies {
    implementation(project(":common"))
}

bungee {
    author = "YourName"
    depends = listOf("SomePlugin")
}

tasks.jar {
    dependsOn(":common:jar")
    from(project(":common").sourceSets.main.get().output)
}
```

**Benefits of build-logic over buildSrc:**
- Faster builds: Changes to convention plugins don't invalidate the entire build cache
- Better IDE performance: Gradle doesn't treat it as a special directory
- Explicit dependency management: You control when convention plugins are rebuilt
- Can be published as a separate artifact if needed

## Dependency Management

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

### Inter-Module Dependencies

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

**Using `implementation`:**

Groovy DSL:
```groovy
// Hides the dependency from consumers
implementation project(':common')
```

Kotlin DSL:
```kotlin
// Hides the dependency from consumers
implementation(project(":common"))
```

**Using `api`:**

Groovy DSL:
```groovy
// Exposes the dependency to consumers (requires java-library plugin)
api project(':api')
```

Kotlin DSL:
```kotlin
// Exposes the dependency to consumers (requires java-library plugin)
api(project(":api"))
```

### Platform Dependencies

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

Each platform module should declare its own dependencies:

**Groovy DSL:**
```groovy
// spigot/build.gradle
dependencies {
    implementation project(':common')
    compileOnly spigots.paper
    implementation 'com.google.code.gson:gson:2.10.1'
}

// bungee/build.gradle
dependencies {
    implementation project(':common')
    compileOnly bungees.bungeecord
    implementation 'com.google.code.gson:gson:2.10.1'
}
```

**Kotlin DSL:**
```kotlin
// spigot/build.gradle.kts
dependencies {
    implementation(project(":common"))
    compileOnly(spigots.paper.api)
    implementation("com.google.code.gson:gson:2.10.1")
}

// bungee/build.gradle.kts
dependencies {
    implementation(project(":common"))
    compileOnly(bungees.bungeecord)
    implementation("com.google.code.gson:gson:2.10.1")
}
```

Groovy DSL:
```groovy
// In build.gradle
dependencies {
    implementation libs.gson
}
```

Kotlin DSL:
```kotlin
// In build.gradle.kts
dependencies {
    implementation(libs.gson)
}
```

### Shadowing Dependencies

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

For Bukkit plugin, use the `libraries` option in plugin.yml instead of shadowJar:

**Groovy DSL:**
```groovy
// spigot/build.gradle
plugins {
    id 'java'
    alias(spigots.plugins.spigot)
}

// ...

dependencies {
    // compileOnlySpigot will be exported to plugin.yml libraries and compileOnly
    compileOnlySpigot libs.gson
}

// ...
```

**Kotlin DSL:**
```kotlin
// spigot/build.gradle.kts
plugins {
    id("java")
    alias(spigots.plugins.spigot)
}

// ...

dependencies {
    // compileOnlySpigot will be exported to plugin.yml libraries and compileOnly
    compileOnlySpigot(libs.gson)
}

// ...
```

When using Shadow plugin to bundle dependencies:

**Groovy DSL:**
```groovy
// bungee/build.gradle
plugins {
    id 'java'
    id("com.gradleup.shadow") version "9.2.2"
    alias(bungees.plugins.bungee)
}

shadowJar {
    // Relocate to avoid conflicts
    relocate 'com.google.gson', 'com.example.myplugin.lib.gson'
}

// Register the shadowJar task
tasks {
    assemble.dependsOn(shadowJar)
}
```

**Kotlin DSL:**
```kotlin
// bungee/build.gradle.kts
plugins {
    id("java")
    id("com.gradleup.shadow") version "9.2.2"
    alias(bungees.plugins.bungee)
}

tasks.shadowJar {
    // Relocate to avoid conflicts
    relocate("com.google.gson", "com.example.myplugin.lib.gson")
}

// Register the shadowJar task
tasks {
    assemble {
        dependsOn(shadowJar)
    }
}
```

## Building Multi-Module Projects

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

### Build All Modules

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

```bash
# Build all modules

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)
./gradlew assemble

# Build specific module

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)
./gradlew :spigot:assemble

# Clean and build

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)
./gradlew clean assemble

# NOTE: build = build with test

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)
# NOTE: assemble = build without test

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)
```

### Build Order

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

Gradle automatically handles build order based on dependencies:
1. `common` module builds first
2. `spigot` and `bungee` build after (since they depend on `common`)

### Artifacts Location

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

Built JARs are located in each module's `build/libs/` directory.

If you enabled the optional `rootProject.children` renaming in `settings.gradle(.kts)`, the jar base names follow the renamed project names (useful for artifactId/archive naming). Otherwise, they follow the default module names.

Example (with renaming enabled):
```
my-plugin/
├── common/build/libs/my-plugin-common-1.0.0.jar
├── spigot/build/libs/my-plugin-spigot-1.0.0.jar
└── bungee/build/libs/my-plugin-bungee-1.0.0.jar
```

### Distribution

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

For distribution, you typically only need platform-specific JARs:
- `my-plugin-spigot-1.0.0.jar` (includes common code)
- `my-plugin-bungee-1.0.0-all.jar` (includes common code through ShadowJar)

The `my-plugin-common-1.0.0.jar` is an intermediate artifact not needed for distribution.

## Best Practices

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

### 1. Keep Common Module Platform-Agnostic

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

**Good:**
```java
// common module
public interface MessageSender {
    void sendMessage(UUID playerId, String message);
}
```

**Bad:**
```java
// common module - DON'T DO THIS
import org.bukkit.entity.Player; // Platform-specific!

public class MessageService {
    public void send(Player player, String msg) { }
}
```

### 2. Use Dependency Injection

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

Avoid static dependencies between modules:

**Good:**
```java
// Spigot module
public class MySpigotPlugin extends JavaPlugin {
    private final MessageService messageService;

    public MySpigotPlugin() {
        this.messageService = new MessageService(new SpigotMessageSender());
    }
}
```

**Bad:**
```java
// Using static references
MessageService.getInstance().send(...);
```

### 3. Version Consistency

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

Keep all modules at the same version by managing it centrally in `gradle.properties`:

```properties
version=1.0.0
```

### 4. Shared Resources

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

For shared resources (like messages, configs), include them in the common module and copy to platform modules:

Groovy DSL:
```groovy
// spigot/build.gradle
processResources {
    from(project(':common').sourceSets.main.resources)
}
```

Kotlin DSL:
```kotlin
// spigot/build.gradle.kts
tasks.processResources {
    from(project(":common").sourceSets.main.get().resources)
}
```

### 5. Main Class Detection

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

Spigradle's main class detection works independently in each platform module:
- `spigot` module: Detects class extending `JavaPlugin`
- `bungee` module: Detects class extending `Plugin`
- `common` module: No main class needed

### 6. Separate Test Dependencies

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

Each module can have its own test dependencies:

Groovy DSL:
```groovy
// spigot/build.gradle
dependencies {
    testImplementation 'org.mockito:mockito-core:5.8.0'
    testImplementation project(':common')
}

// common/build.gradle
dependencies {
    testImplementation 'org.junit.jupiter:junit-jupiter:5.10.1'
}
```

Kotlin DSL:
```kotlin
// spigot/build.gradle.kts
dependencies {
    testImplementation("org.mockito:mockito-core:5.8.0")
    testImplementation(project(":common"))
}

// common/build.gradle.kts
dependencies {
    testImplementation("org.junit.jupiter:junit-jupiter:5.10.1")
}
```

## Troubleshooting

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

### Issue: Circular dependencies

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

**Cause:** Module A depends on Module B, and Module B depends on Module A

**Solution:** Restructure your modules to have a clear dependency hierarchy:
```
api → common → spigot/bungee
```

### Issue: Main class not detected in platform module

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

**Cause:** Main class might be in common module instead of platform module

**Solution:** Ensure your JavaPlugin/Plugin class is in the platform-specific module:
```
✓ spigot/src/.../MySpigotPlugin.java extends JavaPlugin
✗ common/src/.../MyPlugin.java extends JavaPlugin
```

### Issue: NoClassDefFoundError for common classes

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

**Cause:** Common module classes not included in final JAR

**Solution:** Add common module output to JAR:

Groovy DSL:
```groovy
tasks.jar {
    from project(':common').sourceSets.main.output
}
```

Kotlin DSL:
```kotlin
tasks.jar {
    from(project(":common").sourceSets.main.get().output)
}
```

Or use Shadow plugin to bundle:

Groovy DSL:
```groovy
shadowJar {
    from project(':common').sourceSets.main.output
}
```

Kotlin DSL:
```kotlin
tasks.shadowJar {
    from(project(":common").sourceSets.main.get().output)
}
```

### Issue: Duplicate files in JAR

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

**Cause:** Multiple modules contribute the same resource files

**Solution:** Use `duplicatesStrategy`:

Groovy DSL:
```groovy
tasks.jar {
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
    from project(':common').sourceSets.main.output
}
```

Kotlin DSL:
```kotlin
tasks.jar {
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
    from(project(":common").sourceSets.main.get().output)
}
```

## See also

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

- [The Spigot plugin](spigot_plugin.md)
- [The Bungeecord plugin](bungeecord_plugin.md)
- [The Nukkit plugin](nukkit_plugin.md)
- [README.md](../README.md)
- [Gradle Multi-Project Builds](https://docs.gradle.org/current/userguide/multi_project_builds.html)
- [Gradle Multi-Project Builds (rootProject.name)](https://docs.gradle.org/current/userguide/multi_project_builds.html)
- [Gradle Version Catalogs](https://docs.gradle.org/current/userguide/version_catalogs.html)
- [Gradle Toolchains for JVM projects](https://docs.gradle.org/current/userguide/toolchains.html)
- [Gradle Java Library Plugin](https://docs.gradle.org/current/userguide/java_library_plugin.html)
- [Shadow Plugin](https://github.com/GradleUp/shadow)
```
