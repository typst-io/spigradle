# Nukkit Plugin

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

The [NukkitX](https://github.com/NukkitX/Nukkit#introduction) plugin allows you to:

- Generate 'plugin.yml' with less configuration.

- Shortcuts for [dependency](../README.md#dependencies) and [repository](../README.md#repositories).

## Table of contents

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

- [Requirements](#requirements)

- [Usage](#usage)

- [Description file generation](#description-file-generation)

- [Main class detection](#main-class-detection)

- [Configuration](#configuration)

- [Tasks](#tasks)

- [See also](#see-also)

## Requirements

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

The plugin requires Gradle 8.0+, the latest version is recommended.

To update your gradle wrapper:

```
gradlew wrapper --gradle-version 9.2.1 --distribution-type all
```

## Usage

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

[Full Example Here](https://github.com/spigradle/spigradle-sample/tree/master/nukkit)

### Using Version Catalog (Recommended)

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

**settings.gradle.kts**
```kotlin
dependencyResolutionManagement {
    repositories {
        mavenCentral()
    }
    versionCatalogs {
        create("nukkits") {
            from("io.typst:nukkit-catalog:4.0.0")
        }
    }
}
```

**build.gradle.kts**
```kotlin
plugins {
    java
    alias(nukkits.plugins.nukkit)
}

repositories {
    mavenCentral()
    nukkitRepos {
        nukkitX()
    }
}

dependencies {
    compileOnly(nukkits.nukkit.api)
}
```

<details>
<summary>Groovy (settings.gradle)</summary>

```groovy
dependencyResolutionManagement {
    repositories {
        mavenCentral()
    }
    versionCatalogs {
        create('nukkits') {
            from('io.typst:nukkit-catalog:4.0.0')
        }
    }
}
```

</details>

<details>
<summary>Groovy (build.gradle)</summary>

```groovy
plugins {
    id 'java'
    alias nukkits.plugins.nukkit
}

repositories {
    mavenCentral()
    nukkitRepos {
        nukkitX()
    }
}

dependencies {
    compileOnly nukkits.nukkit.api
}
```

</details>

### Without Version Catalog

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

**Groovy DSL**
```groovy
plugins {
    id 'io.typst.spigradle.nukkit' version '4.0.0'
}
```

**Kotlin DSL**
```kotlin
plugins {
    id("io.typst.spigradle.nukkit") version "4.0.0"
}
```

## Description file generation

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

The `plugin.yml` file will be generated by task `generateNukkitPluginDescription` based on the [configuration of `nukkit`](#configuration), included into output jars automatically.

Basically the properties 'main', 'name' and 'version' defaults to [auto-detected main](#main-class-detection), [project.name](https://docs.gradle.org/current/javadoc/org/gradle/api/Project.html#getName--), [project.version](https://docs.gradle.org/current/javadoc/org/gradle/api/Project.html#getName--) respectively.  So if we create a simple plugin that just needs those properties, we don't need any configuration. Only pay attention to your unique implementation.

You can configure all properties of `plugin.yml` in [nukkit {} block](#configuration).

## Main class detection

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

The plugin automatically detects your main plugin class using bytecode analysis (ASM). It scans compiled `.class` files to find classes that extend [PluginBase](https://ci.nukkitx.com/job/NukkitX/job/Nukkit/job/master/javadoc/index.html?overview-summary.html).

**How it works:**
- Scans compiled bytecode (not source code) for faster and more reliable detection
- Finds non-abstract, public classes extending `cn.nukkit.plugin.PluginBase`
- Supports complex inheritance hierarchies
- Incremental: only scans changed files for faster builds
- Automatically sets the `main` property in `plugin.yml`

**Manual override:**
If you need to manually specify the main class:
```groovy
nukkit {
    main.set("com.example.MyCustomMain")
}
```

For more details, see the [Main Class Detection](../README.md#main-class-detection) section.

## Configuration

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

### nukkit - [NukkitExtension](https://docs.typst.io/spigradle/4.0.0/spigradle/io.typst.spigradle.nukkit/-nukkit-extension/index.html)

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

The description of your plugin for a 'plugin.yml'.

About the `plugin.yml`, See [Official Sample](https://github.com/NukkitX/ExamplePlugin/blob/master/src/main/resources/plugin.yml#L1)

<details>
<summary>Groovy Example</summary>

```groovy
nukkit {
    authors = ['Me']
    depend = ['ProtocolLib', 'Vault']
    api = ['1.0.5']
    load = 'STARTUP'
    commands {
        give {
            aliases 'giv', 'i'
            description 'Give command.'
            permission 'test.foo'
            permissionMessage 'You do not have the permission!'
            usage '/<command> [item] [amount]'
        }
    }
    permissions {
        'test.foo' {
            description 'Allows foo command'
            defaults 'true'
        }
        'test.*' {
            description 'Wildcard permission'
            defaults 'op'
            children = ['test.foo': true]
        }
    }
}
```

</details>

<details>
<summary>Kotlin Example</summary>

```kotlin
nukkit {
    authors = listOf("Me")
    depend = listOf("SomePlugin")
    api = listOf("1.0.5")
    load = "STARTUP"  // Property<String>: "STARTUP" or "POSTWORLD"
    commands {
        register("give") {
            aliases = listOf("i")
            description = "Give command."
            permission = "test.foo"
            permissionMessage = "You do not have the permission!"
            usage = "/<command> [item] [amount]"
        }
    }
    permissions {
        register("test.foo") {
            description = "Allows foo command"
            defaults = "true"
        }
        register("test.*") {
            description = "Wildcard permission"
            defaults = "op"
            children = mapOf("test.foo" to true)
        }
    }
}
```

Without [type-safe accessors](https://docs.gradle.org/current/userguide/kotlin_dsl.html#sec:kotlin_using_standard_api):

```kotlin
configure<NukkitExtension> {
    description = "A NukkitX plugin."
    // ...
}
```

</details>

## Tasks

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

All tasks support [UP-TO-DATE check](https://docs.gradle.org/current/userguide/more_about_tasks.html#sec:up_to_date_checks).

**Note:** Debug tasks (server download and run) are currently **Spigot-only**. For NukkitX, you'll need to set up your own development server.

### detectNukkitEntrypoints - [SubclassDetection](https://docs.typst.io/spigradle/4.0.0/spigradle/io.typst.spigradle/-subclass-detection/index.html)

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

Finds the main class that extends [cn.nukkit.plugin.PluginBase](https://ci.nukkitx.com/job/NukkitX/job/Nukkit/job/master/javadoc/index.html?overview-summary.html).

### generateNukkitPluginDescription - [YamlGenerate](https://docs.typst.io/spigradle/4.0.0/spigradle/io.typst.spigradle/-yaml-generate/index.html)

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

*Depends on: `detectNukkitEntrypoints`*

Generates the description file 'plugin.yml'.

## See also

[comment]: <> (!! Do not edit this file but 'docs/templates' or 'docs/root-templates', See [CONTRIBUTING.md] !!)

- [The Spigot plugin](spigot_plugin.md)
- [The Bungeecord plugin](bungeecord_plugin.md)
- [README.md](../README.md)
- [Gradle Kotlin DSL Primer](https://docs.gradle.org/current/userguide/kotlin_dsl.html)
